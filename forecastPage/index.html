<!DOCTYPE html>
<html>
  <head>
    <script src="./papaparse.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function loadFile(filePath) {
        var result = null;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", filePath, false);
        xmlhttp.send();
        if (xmlhttp.status==200) {
          result = xmlhttp.responseText;
        }
        return result;
      }

      csvData = Papa.parse(loadFile('predicted.csv'));
      csvData = csvData.data;

      for(var i = 1; i < csvData.length; i++){
        csvData[i][0] = parseFloat(csvData[i][0]);
        csvData[i][1] = parseFloat(csvData[i][1]);
        csvData[i][2] = parseFloat(csvData[i][2]);
      }

      var clearskySum = 0;
      var predictedSum = 0;

      for(var i = 1; i<24; i++){
        clearskySum += csvData[i][1];
        predictedSum += csvData[i][2];
      }

      var ratio = predictedSum/clearskySum;
      var percent = parseInt(ratio*100);

      function drawChart() {

        var data = google.visualization.arrayToDataTable(csvData);

        var options = {
          title: 'San Diego CA',
          legend: { position: 'bottom' },
          chartArea: {'width': '85%', 'height': '80%'},
          vAxis: {title: 'Watts'},
          hAxis: {title: 'Time'}
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

        chart.draw(data, options);


        document.getElementById('largePercent').innerHTML = percent+"%";
        document.getElementById('innerSunBar').style.width = percent+"%";
      }
    </script>

    <link rel="stylesheet" type="text/css" href="css/styles.css">

    <title>San Diego</title>
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Rajdhani|Roboto|Russo+One" rel="stylesheet">
  </head>

  <body>
    <div class= "flexBox">
      <div class = "fullWideGrey">
        <div class = "middleBox">
          <div class = "weatherbox1">
            <div id = "largePercent">0%</div>
            <div class = "whiteText">of clear sky today</div>
            <div id = "sunBar"><div id = "innerSunBar"></div></div>
          </div>
          <p class = 'normalParagraph'> Solar power prediction for San Diego using a MLPRegression model trained on data from Hanford CA. To learn more about how it works, check out the link below.</p>
        </div>
      </div>
      <div class = "fullWideYellow">
        <div class = "middleBox"><div id="curve_chart" class = "mainChart"></div></div>
      </div>
    </div>
  </body>
</html>
